# 全屏图片查看器功能说明

## 📸 功能概述

用户完成换髮型后，可以通过多种方式打开全屏查看器，以全屏模式查看三张图片（试髮前、试髮后、前后比较），并支持触摸滑动切换。

---

## 🎯 主要功能

### 1. **打开全屏查看器的方式**

#### 方式一：点击按钮
- 点击「试髮前」按钮 → 打开全屏查看器并显示试髮前图片
- 点击「试髮后」按钮 → 打开全屏查看器并显示试髮后图片
- 点击「前后比较」按钮 → 打开全屏查看器并显示对比图片

#### 方式二：点击结果图片
- 直接点击显示的结果图片 → 根据当前显示的图片打开对应的全屏视图

### 2. **全屏模式下的操作**

#### 触摸滑动切换（移动设备）
- **向左滑动** → 切换到下一张图片
- **向右滑动** → 切换到上一张图片
- **最小滑动距离**：50px（避免误触）

#### 按钮导航
- **左箭头按钮（‹）** → 上一张
- **右箭头按钮（›）** → 下一张

#### 键盘导航（桌面设备）
- **左箭头键** → 上一张
- **右箭头键** → 下一张
- **ESC 键** → 关闭全屏查看器

#### 指示器导航
- 点击底部的圆点指示器 → 直接跳转到对应图片

#### 关闭查看器
- 点击右上角的「×」按钮
- 按下 ESC 键（桌面）

### 3. **视觉特效**

- **背景**：半透明黑色遮罩（95% 不透明度）
- **图片**：自适应屏幕大小，最大显示 95% 的视窗空间
- **标签**：顶部显示当前图片名称（试髮前/试髮后/前后比较）
- **指示器**：底部圆点显示当前位置，当前图片的指示器会放大并变亮
- **过渡动画**：图片切换时有平滑的淡入淡出效果

---

## 🎨 界面元素

### 全屏查看器布局

```
┌─────────────────────────────────────────┐
│                  [标签]              [×]│  顶部：标签 + 关闭按钮
│                                         │
│                                         │
│  [‹]          [图片内容]          [›]  │  中间：左右导航 + 图片
│                                         │
│                                         │
│              [● ○ ○]                    │  底部：指示器
└─────────────────────────────────────────┘
```

### 元素说明

| 元素 | 位置 | 功能 |
|------|------|------|
| **关闭按钮（×）** | 右上角 | 关闭全屏查看器 |
| **标签** | 顶部中央 | 显示当前图片名称 |
| **左箭头（‹）** | 左侧中央 | 切换到上一张 |
| **右箭头（›）** | 右侧中央 | 切换到下一张 |
| **圆点指示器** | 底部中央 | 显示当前位置，可点击跳转 |

---

## 📱 响应式设计

### 桌面版（> 768px）
- 按钮大小：60px × 60px
- 标签字体：20px
- 指示器大小：12px
- 支持键盘导航

### 移动版（≤ 768px）
- 按钮大小：50px × 50px
- 标签字体：16px
- 指示器大小：10px
- 支持触摸滑动手势
- 优化触摸区域

---

## 🔧 技术实现

### 文件结构

```
live_tryHair/
├── static/
│   ├── css/
│   │   └── theme.css          # 全屏查看器样式（第 631-824 行）
│   └── js/
│       └── user.js             # 全屏查看器逻辑（第 781-961 行）
└── templates/
    └── user/
        └── index.html          # 全屏查看器 HTML（第 53-78 行）
```

### 核心类和方法

#### `fullscreenViewer` 对象

```javascript
fullscreenViewer = {
  // 属性
  currentIndex: 1,              // 当前显示的图片索引
  labels: ['试髮前', '试髮后', '前后比较'],
  minSwipeDistance: 50,         // 最小滑动距离
  
  // 方法
  init()                        // 初始化查看器
  open(index)                   // 打开查看器并显示指定图片
  close()                       // 关闭查看器
  navigate(direction)           // 导航（-1=上一张，+1=下一张）
  goTo(index)                   // 跳转到指定图片
  handleSwipe()                 // 处理触摸滑动
  updateView()                  // 更新界面显示
}
```

### 事件绑定

1. **按钮点击**
   - 三个视图切换按钮 → `open(index)`
   - 结果图片 → `open(index)`（根据当前显示的图片）

2. **全屏内导航**
   - 关闭按钮 → `close()`
   - 左/右箭头 → `navigate(±1)`
   - 指示器 → `goTo(index)`

3. **手势和键盘**
   - `touchstart` + `touchend` → `handleSwipe()`
   - `keydown` (ESC/ArrowLeft/ArrowRight) → 对应操作

---

## 🎬 用户体验流程

### 标准使用流程

```
1. 用户完成换髮型
   ↓
2. 系统显示三个按钮：试髮前 | 试髮后 | 前后比较
   ↓
3. 用户点击任意按钮或结果图片
   ↓
4. 全屏查看器打开，显示对应图片
   ↓
5. 用户可以：
   - 左右滑动切换图片
   - 点击左右箭头
   - 点击底部指示器
   - 按键盘左右键（桌面）
   ↓
6. 用户点击关闭按钮或按 ESC 键退出
```

### 触摸滑动逻辑

```
用户触摸屏幕 (touchstart)
   ↓
记录起始位置 (touchStartX)
   ↓
用户滑动并松开 (touchend)
   ↓
记录结束位置 (touchEndX)
   ↓
计算滑动距离 = touchStartX - touchEndX
   ↓
距离 > 50px ?
   Yes → 向左滑动 → 下一张
   Yes → 向右滑动 → 上一张
   No  → 忽略（可能是误触或点击）
```

---

## 🎨 样式细节

### CSS 类名约定

| 类名 | 用途 |
|------|------|
| `.fullscreen-viewer` | 查看器容器 |
| `.fullscreen-viewer.active` | 激活状态（显示） |
| `.fullscreen-viewer__close` | 关闭按钮 |
| `.fullscreen-viewer__label` | 顶部标签 |
| `.fullscreen-viewer__nav` | 导航按钮 |
| `.fullscreen-viewer__nav--prev` | 上一张按钮 |
| `.fullscreen-viewer__nav--next` | 下一张按钮 |
| `.fullscreen-viewer__container` | 图片容器 |
| `.fullscreen-viewer__image-wrapper` | 图片包装器 |
| `.fullscreen-viewer__image-wrapper.active` | 当前显示的图片 |
| `.fullscreen-viewer__image` | 图片元素 |
| `.fullscreen-viewer__indicators` | 指示器容器 |
| `.fullscreen-viewer__indicator` | 单个指示器 |
| `.fullscreen-viewer__indicator.active` | 当前指示器 |

### 颜色方案

- **背景遮罩**：`rgba(0, 0, 0, 0.95)`
- **按钮背景**：`rgba(255, 255, 255, 0.2)` → 悬停 `rgba(255, 255, 255, 0.3)`
- **标签背景**：`rgba(0, 0, 0, 0.3)`
- **指示器**：`rgba(255, 255, 255, 0.4)` → 激活 `rgba(255, 255, 255, 0.9)`

---

## 🚀 使用示例

### 在代码中打开全屏查看器

```javascript
// 打开并显示"试髮前"
fullscreenViewer.open(0);

// 打开并显示"试髮后"（默认）
fullscreenViewer.open(1);

// 打开并显示"前后比较"
fullscreenViewer.open(2);

// 关闭查看器
fullscreenViewer.close();

// 导航
fullscreenViewer.navigate(-1);  // 上一张
fullscreenViewer.navigate(1);   // 下一张

// 跳转到指定图片
fullscreenViewer.goTo(2);  // 跳转到"前后比较"
```

---

## ✨ 特色功能

1. **智能打开**：点击结果图片时，根据当前显示的是哪张图片，自动在全屏查看器中显示对应图片

2. **防止误触**：触摸滑动需要达到 50px 的距离才会触发切换，避免误操作

3. **键盘友好**：桌面用户可以使用键盘导航，提升操作效率

4. **无限循环**：默认不循环（到达第一张/最后一张时停止），符合直觉

5. **平滑过渡**：图片切换有淡入淡出效果，视觉体验流畅

6. **防止滚动**：全屏模式下，背景页面不会滚动

---

## 📋 注意事项

1. **图片加载**：确保 `imageUrls.before`、`imageUrls.after`、`imageUrls.comparison` 都已正确设置

2. **触摸事件**：使用 `{ passive: true }` 提高滚动性能

3. **Z-index 层级**：全屏查看器的 z-index 为 10000，确保在所有内容之上

4. **浏览器兼容性**：支持现代浏览器（Chrome、Firefox、Safari、Edge）

---

## 🔄 更新历史

- **2025-11-09**: 初始版本，实现全屏图片查看器功能
  - 支持触摸滑动切换
  - 支持键盘导航
  - 支持多种打开方式
  - 响应式设计

